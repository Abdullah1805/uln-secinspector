import re

def scan_terraform(text):
    findings = []

    if "0.0.0.0/0" in text:
        findings.append({
            "title": "Security Group مفتوح للعالم",
            "severity": "High",
            "impact": "السيرفر متاح لأي شخص من الإنترنت.",
            "evidence": "0.0.0.0/0",
            "recommendation": "تقييد العناوين المسموح لها بالوصول."
        })

    if 'acl = "public-read"' in text:
        findings.append({
            "title": "S3 Bucket عام بدون حماية",
            "severity": "High",
            "impact": "البيانات يمكن الوصول لها بدون صلاحية.",
            "evidence": "acl = public-read",
            "recommendation": "اجعل الـ bucket خاصًا واستخدم IAM."
        })

    if re.search(r'Action\s*=\s*"\*"', text):
        findings.append({
            "title": "IAM Policy بصلاحيات كاملة",
            "severity": "Critical",
            "impact": "إمكانية السيطرة الكاملة على الحساب.",
            "evidence": 'Action = "*"',
            "recommendation": "تقييد الصلاحيات حسب الحاجة."
        })

    return findings
